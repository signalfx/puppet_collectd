# Generated by Puppet
# Install:
#  You can usually install with apt-get or yum

# Documentation:
#   https://collectd.org/documentation.shtml

# System modifications:
#   None

# Config file modifications:
#   If you want to use a custom source name, change
#   the "Hostname" paramter and set
#
#     FQDNLookup false
#
#   Make sure TypesDB points to a valid file:
#
#     which %%%COLLECTDSHARE%%%/types.db
#
#   Create the directory managed_config and put
#   extra config files there:
#
#     mkdir /etc/collectd/managed_config
#

TypesDB "/usr/share/collectd/types.db"

#   If you use the Hostname parameter, you
#   must quote ("...") the second argument
### Hostname "<YOUR_HOSTNAME_HERE>"

<% if @fqdnlookup %>
FQDNLookup true
<% else %>
Hostname "<%= @hostname %>"
FQDNLookup false
<% end %>
Interval <%= @interval %>
Timeout <%= @timeout %>
ReadThreads <%= @read_threads %>
WriteQueueLimitHigh <%= @write_queue_limit_high %>
WriteQueueLimitLow  <%= @write_queue_limit_low %>
CollectInternalStats <%= @collect_internal_stats %>

LoadPlugin logfile

<Plugin logfile>
  LogLevel "<%= @log_level %>"
  File "<%= @log_file %>"
  Timestamp true
  PrintSeverity false
</Plugin>

<%- @loadplugins.each do |plugin, loadplugin_config| -%>
<LoadPlugin <%= plugin %>>
  <%- loadplugin_config.sort_by { |k| k }.each do |key,value| -%>
  <%= key -%> <%= value %>
  <%- end -%>
</LoadPlugin>
<%- end -%>

<% if @use_default_cpu_plugin %>
LoadPlugin cpu
<% end %>

<% if @use_default_cpufreq_plugin %>
LoadPlugin cpufreq
<% end %>

<% if @use_default_df_plugin %>
LoadPlugin df
<% end %>

<% if @use_default_disk_plugin %>
LoadPlugin disk
<Plugin "disk">
  Disk "/^loop\d+$/"
  Disk "/^dm-\d+$/"
  IgnoreSelected "true"
</Plugin>
<% end %>

<% if @use_default_interface_plugin %>
LoadPlugin interface
<Plugin "interface">
  Interface "/^lo\d*$/"
  Interface "/^docker.*/"
  Interface "/^t(un|ap)\d*$/"
  Interface "/^veth.*$/"
  IgnoreSelected "true"
</Plugin>
<% end %>

<% if @use_default_load_plugin %>
LoadPlugin load
<% end %>

<% if @use_default_memory_plugin %>
LoadPlugin memory
<% end %>

<% if @use_default_protocols_plugin %>
LoadPlugin protocols
<Plugin "protocols">
  Value "Icmp:InDestUnreachs"
  Value "Tcp:CurrEstab"
  Value "Tcp:OutSegs"
  Value "Tcp:RetransSegs"
  Value "TcpExt:DelayedACKs"
  Value "TcpExt:DelayedACKs"

  Value "/Tcp:.*Opens/"
  Value "/^TcpExt:.*Octets/"
  IgnoreSelected false
</Plugin>
<% end %>

<% if @use_default_vmem_plugin %>
LoadPlugin vmem
<Plugin vmem>
  Verbose false
</Plugin>
<% end %>

<% if @use_default_uptime_plugin %>
LoadPlugin uptime
<% end %>

<% @include_plugin_dirs.each do |folder| -%>
Include "<%= folder %>/*.conf"
<% end -%>
