# Generated by Puppet
# Install:
#   This plugin is sometimes bundled with collectd, if not
#   you can install with:
#     apt-get install collectd-mysql

# Documentation:
#   https://collectd.org/wiki/index.php/Plugin:MySQL

# System modifications:
#   None

# Config file modifications:
#   Change the host/socket/user/password/database parameters to point to
#   your mysql install.  You can usually find the "socket" parameter by
#   looking at your mysql command with:
#
#     ps auwxxx | grep mysql

LoadPlugin mysql
<Plugin mysql>
  <% @modules.each do |module_instance, module_config| -%>
  <Database <%= module_instance -%> >
    <% module_config.sort_by { |k| k }.each do |key,value| -%>
    <%= key -%> <%= value %>
    <% end -%>
  </Database>
  <% end -%>
</Plugin>

<%- if @filter_metrics == true -%>
LoadPlugin match_regex
<Chain "PostCache">
  <Rule>
    <Match "regex">
      Plugin "^mysql$"
    </Match>
    <Target "jump">
      Chain "FilterMySqlStats"
    </Target>
  </Rule>
  Target "write"
</Chain>

<Chain "FilterMySqlStats">
<%- @filter_metric_rules.each do |rule_instance, rule| -%>
    <Rule "<%= rule_instance -%>">
      <Match "regex">
      <%- rule.sort_by { |k| k }.each do |key,value| -%>
        <%- if key != "Type" -%>
        <%= key -%> "<%= value %>"
	<%- else -%>
        <%= key -%> "^<%= value %>$"
	<%- end -%>
      <%- end -%>
      </Match>
      Target "return"
    </Rule>
<%- end -%>
  Target "stop"
</Chain>
<%- end -%>
